<!DOCTYPE html>
<html>

<head>
    <link rel="shortcut  icon" type="image/x-icon" href="favicon.ico" media="screen" />
    <meta name="viewport" content="width=device-width, initial-scale=1" charset="UTF-8">
    <link href="style.css" rel="stylesheet">
    <title>JSON树状图生成器</title>
</head>

<body>
    <h1>JSON树状图生成器</h1>
    <span id="control">
        主题: <select id="themes" class="input"></select>
        字体: <input type="text" class="input" id="font" value="monospace">
        大小: <input type="number" class="input" id="resolution" value="32" min="1"><br>
        <textarea id="text" class="input" rows=8 cols=60 placeholder="来一段JSON"></textarea>
        <div>
            <button id="submit" class="btn">提交</button>
            <button id="clear" class="btn">清除</button>
        </div>
    </span>
    <span id='dls'><a id='dl'>下载</a></span>
    <span class="canvas">
        <canvas id="canvas" width="256" height="256"></canvas>
    </span>
    <script src="theme.js"></script>
    <script src="draw.js"></script>
    <script src="download.js"></script>
    <script>
        let submit = document.getElementById('submit');
        let clear = document.getElementById('clear');
        let textarea = document.getElementById('text');
        let dl = document.getElementById('dl');
        let dls = document.getElementById('dls');
        submit.addEventListener("click", () => {
            dls.style.display = 'block';
            draw(textarea.value);
        });
        clear.addEventListener("click", () => {
            textarea.value = '';
        });
        dl.addEventListener("click", () => {
            try {
                let blob = dataURItoBlob(c.toDataURL());
                let url = window.URL.createObjectURL(blob);
                let link = document.createElement('a');
                link.style.display = 'none';
                link.href = url;
                link.setAttribute('download', parseInt(new Date().getTime() / 1000) + '.png');
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            } catch (e) {
                console.error(e.stack);
                alert('请使用右键另存为。');
            }
        });
    </script>
</body>

</html>