<!DOCTYPE html>
<html class='transition'>

<head>
    <link rel="shortcut  icon" type="image/x-icon" href="favicon.ico" media="screen" />
    <meta name="viewport" content="width=device-width, initial-scale=1" charset="UTF-8">
    <link href="css/style.css" rel="stylesheet">
    <title>JSON树状图生成器</title>
</head>

<body>
    <ul id="list" class="input border">
        <li class="btn input transition text">复制属性路径</li>
        <li class="btn input transition text">复制属性键</li>
        <li class="btn input transition text">复制属性值</li>
    </ul>
    <textarea cols="20" rows="10" id="copy" class="transition border input">用户定义的代码区域</textarea>
</body>

<body>
    <h1>JSON树状图生成器</h1>
    <span id="control" class="border">
        主题: <select id="themes" class="transition border input text"></select>
        字体: <input type="text" class="transition border input text" id="font" value="monospace">
        大小: <input type="number" class="transition border input text" id="resolution" value="32" min="1"><br>
        <div hidden><input type="checkbox" class="" id="fix" value="3">尝试修复json（实验性）</div>
        <textarea id="text" class="transition border input" rows=8 cols=60 placeholder="来一段JSON"></textarea>
        <div>
            <button id="submit" class="transition border input btn text">提交</button>
            <button id="clear" class="transition border input btn text">清除</button>
        </div>
    </span>
    <a id='dl' class="text">下载</a>
    <span id="format" class="border"></span>
    <span class="canvas">
        <canvas id="canvas" width="256" height="256"></canvas>
    </span>
    <script src="js/parser.js"></script>
    <script src="js/theme.js"></script>
    <script src="js/manager.js"></script>
    <script src="js/draw.js"></script>
    <script src="js/htmlGen.js"></script>
    <script src="js/download.js"></script>
    <script src="js/utils.js"></script>
    <script>
        let submit = document.getElementById('submit');
        let clear = document.getElementById('clear');
        let textarea = document.getElementById('text');
        let dl = document.getElementById('dl');
        let dls = document.getElementById('dls');
        submit.addEventListener("click", () => {
            draw(textarea.value);
        });
        clear.addEventListener("click", () => {
            textarea.value = '';
        });
        dl.addEventListener("click", () => {
            try {
                let blob = dataURItoBlob(c.toDataURL());
                let url = window.URL.createObjectURL(blob);
                let link = document.createElement('a');
                link.style.display = 'none';
                link.href = url;
                link.setAttribute('download', parseInt(new Date().getTime() / 1000) + '.png');
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            } catch (e) {
                console.error(e.stack);
                alert('请使用右键另存为。');
            }
        });
    </script>
</body>

</html>